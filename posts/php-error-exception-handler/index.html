<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>PHP 中的错误和异常处理 - Jinyun&#39;s Notes</title><meta name="Description" content="进一寸有进一寸的欢喜，退一步有退一步的从容"><meta property="og:title" content="PHP 中的错误和异常处理" />
<meta property="og:description" content="PHP 当然也有自己的异常处理，不过那已经是 PHP5 以后的事了。就我自己这些年写程序的现状看，我基本上就没有真正明白什么是异常处理，经常把异常和错误处理混为一谈，关于代码中的那些写法，不是写错了，就是写的太特么烂了。恰好最近在写一些类时用到异常处理了，顺便就把这个整理下，但是这个仅代表我个人的一些理解和使用，也可能是错误的，还请谨慎阅读。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://imajinyun.xyz/posts/php-error-exception-handler/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-04-05T17:41:59+08:00" />
<meta property="article:modified_time" content="2018-04-05T17:41:59+08:00" /><meta property="og:site_name" content="Jinyun&#39;s Notes" />
<meta property="og:see_also" content="https://imajinyun.xyz/posts/php-src-learning2/" /><meta property="og:see_also" content="https://imajinyun.xyz/posts/php-src-learning1/" /><meta property="og:see_also" content="https://imajinyun.xyz/posts/php-array-sort/" /><meta property="og:see_also" content="https://imajinyun.xyz/posts/php-some-ingenious-ways/" /><meta property="og:see_also" content="https://imajinyun.xyz/posts/php-php74-new-features/" /><meta property="og:see_also" content="https://imajinyun.xyz/posts/php-swoole-get-started/" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="PHP 中的错误和异常处理"/>
<meta name="twitter:description" content="PHP 当然也有自己的异常处理，不过那已经是 PHP5 以后的事了。就我自己这些年写程序的现状看，我基本上就没有真正明白什么是异常处理，经常把异常和错误处理混为一谈，关于代码中的那些写法，不是写错了，就是写的太特么烂了。恰好最近在写一些类时用到异常处理了，顺便就把这个整理下，但是这个仅代表我个人的一些理解和使用，也可能是错误的，还请谨慎阅读。"/>
<meta name="application-name" content="进一寸有进一寸的欢喜，退一步有退一步的从容">
<meta name="apple-mobile-web-app-title" content="进一寸有进一寸的欢喜，退一步有退一步的从容"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="https://inotes.oss-cn-beijing.aliyuncs.com/common/201812/logo.svg"><link rel="apple-touch-icon" sizes="180x180" href="https://imajinyun.xyz/apple-touch-icon.png"><link rel="mask-icon" href="https://imajinyun.xyz/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="https://imajinyun.xyz/site.webmanifest"><link rel="canonical" href="https://imajinyun.xyz/posts/php-error-exception-handler/" /><link rel="prev" href="https://imajinyun.xyz/posts/php-highlight/" /><link rel="next" href="https://imajinyun.xyz/posts/php-date-calculation/" /><link rel="stylesheet" href="https://imajinyun.xyz/css/style.min.css"><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "PHP 中的错误和异常处理",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/imajinyun.xyz\/posts\/php-error-exception-handler\/"
        },"genre": "posts","keywords": "PHP","wordcount":  3131 ,
        "url": "https:\/\/imajinyun.xyz\/posts\/php-error-exception-handler\/","datePublished": "2018-04-05T17:41:59+08:00","dateModified": "2018-04-05T17:41:59+08:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "作者"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="https://imajinyun.xyz/" title="Jinyun&#39;s Notes"><span class="header-title-pre"><i class='fa fa-charging-station'></i></span>Jinyun&#39;s Notes</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="https://imajinyun.xyz/posts/"><i class='fa-solid fa-sun'></i> 笔记 </a><a class="menu-item" href="https://imajinyun.xyz/tags/"><i class='fa-solid fa-tags'></i> 标签 </a><a class="menu-item" href="https://imajinyun.xyz/categories/"><i class='fa-solid fa-layer-group'></i> 分类 </a><a class="menu-item" href="https://imajinyun.xyz/docs/"><i class='fa-solid fa-file-word'></i> 文档 </a><a class="menu-item" href="https://imajinyun.xyz/links/"><i class='fa fa-link'></i> 友链 </a><a class="menu-item" href="https://imajinyun.xyz/about/"><i class='fa fa-paper-plane'></i> 关于 </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="https://imajinyun.xyz/" title="Jinyun&#39;s Notes"><span class="header-title-pre"><i class='fa fa-charging-station'></i></span>Jinyun&#39;s Notes</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="https://imajinyun.xyz/posts/" title=""><i class='fa-solid fa-sun'></i>笔记</a><a class="menu-item" href="https://imajinyun.xyz/tags/" title=""><i class='fa-solid fa-tags'></i>标签</a><a class="menu-item" href="https://imajinyun.xyz/categories/" title=""><i class='fa-solid fa-layer-group'></i>分类</a><a class="menu-item" href="https://imajinyun.xyz/docs/" title=""><i class='fa-solid fa-file-word'></i>文档</a><a class="menu-item" href="https://imajinyun.xyz/links/" title=""><i class='fa fa-link'></i>友链</a><a class="menu-item" href="https://imajinyun.xyz/about/" title=""><i class='fa fa-paper-plane'></i>关于</a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">PHP 中的错误和异常处理</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://imajinyun.xyz/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>作者</a></span>&nbsp;<span class="post-category">收录于 <a href="https://imajinyun.xyz/categories/php/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>PHP</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2018-04-05">2018-04-05</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;约 3131 字&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;预计阅读 7 分钟&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#概述">概述</a>
      <ul>
        <li><a href="#错误处理定义">错误处理定义</a></li>
        <li><a href="#异常处理定义">异常处理定义</a></li>
        <li><a href="#预定义的错误代码">预定义的错误代码</a></li>
        <li><a href="#相关文章">相关文章</a></li>
        <li><a href="#错误处理">错误处理</a></li>
      </ul>
    </li>
    <li><a href="#异常处理">异常处理</a>
      <ul>
        <li><a href="#自定义捕获错误和异常">自定义捕获错误和异常</a>
          <ul>
            <li><a href="#正常情况时的异常捕获">正常情况时的异常捕获</a></li>
            <li><a href="#写错语法时的异常捕获">写错语法时的异常捕获</a></li>
          </ul>
        </li>
        <li><a href="#框架中的错误异常处理">框架中的错误异常处理</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>PHP 当然也有自己的异常处理，不过那已经是 PHP5 以后的事了。就我自己这些年写程序的现状看，我基本上就没有真正明白什么是异常处理，经常把异常和错误处理混为一谈，关于代码中的那些写法，不是写错了，就是写的太特么烂了。恰好最近在写一些类时用到异常处理了，顺便就把这个整理下，但是这个仅代表我个人的一些理解和使用，也可能是错误的，还请谨慎阅读。</p>
<h2 id="概述">概述</h2>
<h3 id="错误处理定义">错误处理定义</h3>
<p>错误是指导致系统不能按照用户意图工作的一切原因、事件。在程序设计过程中，由于某些错误的存在，致使程序无法正常运行，处理这些错误以使程序正确运行就称为错误处理。错误处理功能是衡量编译器性能的重要方面，它在帮助程序员尽快修改程序方面起到了非常重要的作用。</p>
<p>错误类型：</p>
<ul>
<li>语法错误</li>
<li>语义错误</li>
<li>逻辑错误</li>
</ul>
<h3 id="异常处理定义">异常处理定义</h3>
<p>编程语言或计算机硬件里的一种机制，用于处理软件或信息系统中出现的异常状况（即超出程序正常执行流程的某些特殊条件）</p>
<h3 id="预定义的错误代码">预定义的错误代码</h3>
<p>当然你也可以参见官网的手册 <strong><a href="http://php.net/manual/zh/errorfunc.constants.php" target="_blank" rel="noopener noreffer">预定义常量</a></strong>，我抄一遍纯粹是为了加深记忆。至于每种错误在什么情况下产生，你可以参看 <strong><a href="http://www.cnblogs.com/yjf512/p/5314345.html" target="_blank" rel="noopener noreffer">PHP的错误机制总结</a></strong>。</p>
<table>
<thead>
<tr>
<th>常量</th>
<th>取值</th>
<th>说明</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>E_ERROR</code></td>
<td>1</td>
<td>致命的运行时错误。这类错误一般是不可恢复的情况，例如内存分配导致的问题。后果是导致脚本终止不再继续运行</td>
<td></td>
</tr>
<tr>
<td><code>E_WARNING</code></td>
<td>2</td>
<td>运行时警告（非致命错误）。仅给出提示信息，但是脚本不会终止运行</td>
<td></td>
</tr>
<tr>
<td><code>E_PARSE</code></td>
<td>4</td>
<td>编译时语法解析错误。解析错误仅仅由分析器产生</td>
<td></td>
</tr>
<tr>
<td><code>E_NOTICE</code></td>
<td>8</td>
<td>运行时通知。表示脚本遇到可能会表现为错误的情况，但是在可以正常运行的脚本里面也可能会有类似的通知</td>
<td></td>
</tr>
<tr>
<td><code>E_CORE_ERROR</code></td>
<td>16</td>
<td>在 PHP 初始化启动过程中发生的致命错误。该错误类似 E_ERROR，但是是由 PHP 引擎核心产生的</td>
<td>since PHP 4</td>
</tr>
<tr>
<td><code>E_CORE_WARNING</code></td>
<td>32</td>
<td>PHP 初始化启动过程中发生的警告（非致命错误）。类似 E_WARNING，但是是由 PHP 引擎核心产生的</td>
<td>since PHP 4</td>
</tr>
<tr>
<td><code>E_COMPILE_ERROR</code></td>
<td>64</td>
<td>致命编译时错误。类似 E_ERROR，但是是由 Zend 脚本引擎产生的</td>
<td>since PHP 4</td>
</tr>
<tr>
<td><code>E_COMPILE_WARNING</code></td>
<td>128</td>
<td>编译时警告（非致命错误）。类似 E_WARNING，但是是由 Zend 脚本引擎产生的</td>
<td>since PHP 4</td>
</tr>
<tr>
<td><code>E_USER_ERROR</code></td>
<td>256</td>
<td>用户产生的错误信息。类似 E_ERROR，但是是由用户自己在代码中使用 PHP 函数 trigger_error() 来产生的</td>
<td>since PHP 4</td>
</tr>
<tr>
<td><code>E_USER_WARNING</code></td>
<td>512</td>
<td>用户产生的警告信息。类似 E_WARNING，但是是由用户自己在代码中使用 PHP 函数 trigger_error() 来产生的</td>
<td>since PHP 4</td>
</tr>
<tr>
<td><code>E_USER_NOTICE</code></td>
<td>1024</td>
<td>用户产生的通知信息。类似 E_NOTICE，但是是由用户自己在代码中使用 PHP 函数 trigger_error() 来产生的</td>
<td>since PHP 4</td>
</tr>
<tr>
<td><code>E_STRICT</code></td>
<td>2048</td>
<td>启用 PHP 对代码的修改建议，以确保代码具有最佳的互操作性和向前兼容性</td>
<td>since PHP 5</td>
</tr>
<tr>
<td><code>E_RECOVERABLE_ERROR</code></td>
<td>4096</td>
<td>可被捕捉的致命错误。它表示发生了一个可能非常危险的错误，但是还没有导致 PHP 引擎处于不稳定的状态。如果该错误没有被用户自定义句柄捕获（参见 set_error_handler()），将成为一个 E_ERROR　从而脚本会终止运行</td>
<td>since PHP 5.2.0</td>
</tr>
<tr>
<td><code>E_DEPRECATED</code></td>
<td>8192</td>
<td>运行时通知。启用后将会对在未来版本中可能无法正常工作的代码给出警告</td>
<td>since PHP 5.3.0</td>
</tr>
<tr>
<td><code>E_USER_DEPRECATED</code></td>
<td>16384</td>
<td>用户产少的警告信息。类似 E_DEPRECATED，但是是由用户自己在代码中使用 PHP 函数 trigger_error() 来产生的</td>
<td>since PHP 5.3.0</td>
</tr>
<tr>
<td><code>E_ALL</code></td>
<td>30719</td>
<td><code>E_STRICT</code> 出外的所有错误和警告信息</td>
<td>30719 in PHP 5.3.x, 6143 in PHP 5.2.x, 2047 previously</td>
</tr>
</tbody>
</table>
<div class="details admonition warning open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-exclamation-triangle fa-fw" aria-hidden="true"></i>警告<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content"><ul>
<li>可以使用按位运算符来组合这些值或者屏蔽某些类型的错误。在 <code>php.ini</code> 之中，仅 <code>|, ~, !, ^, &amp;</code> 这些操作符会被正确解析</li>
<li>以下级别的错误不能由用户定义的函数来处理：<code>E_ERROR</code>、<code>E_PARSE</code>、<code>E_CORE_ERROR</code>、<code>E_CORE_WARNING</code>、<code>E_COMPILE_ERROR</code>、<code>E_COMPILE_WARNING</code> 和在调用 <code>set_error_handler()</code> 函数所在文件中产生的大多数 <code>E_STRICT</code></li>
</ul>
</div>
        </div>
    </div>
<h3 id="相关文章">相关文章</h3>
<ul>
<li><a href="http://www.laruence.com/2010/08/03/1697.html" target="_blank" rel="noopener noreffer">深入理解PHP原理之异常机制</a></li>
<li><a href="http://www.laruence.com/2012/02/02/2515.html" target="_blank" rel="noopener noreffer">我们什么时候应该使用异常</a></li>
<li><a href="https://laravel-china.org/articles/5435/exceptions-and-errors-in-php-best-practices" target="_blank" rel="noopener noreffer">PHP 最佳实践之异常和错误</a></li>
<li><a href="https://trowski.com/2015/06/24/throwable-exceptions-and-errors-in-php7/" target="_blank" rel="noopener noreffer">Throwable Exceptions and Errors in PHP 7</a></li>
</ul>
<p>早有人把 PHP 各个版本的错误和异常处理类树整理出来供我等参观。如果在本地执行此代码，依据本地对 PHP 安装的扩展的不同，会把扩展中的相关异常处理类一并打印出来</p>
<ul>
<li><a href="https://gist.github.com/mlocati/249f07b074a0de339d4d1ca980848e6a" target="_blank" rel="noopener noreffer">打印错误和异常处理类树代码</a></li>
<li><a href="https://3v4l.org/sDMsv#output" target="_blank" rel="noopener noreffer">打印输出结果</a></li>
</ul>
<h3 id="错误处理">错误处理</h3>
<blockquote>
<ul>
<li>Note that other types of errors such as warnings and notices remain unchanged in PHP 7. Only fatal and recoverable errors throw exceptions.</li>
<li>Prior to PHP 7 alpha-2, the exception hierarchy in PHP 7 was different. Fatal and recoverable errors threw instances of EngineException, which did not inherit from Exception. Both Exception and EngineException inherited from BaseException. The hierarchy was revised with the RFC I authored, Throwable Interface. I felt switching to Throwable and Error was important to avoid confusion from classes using the suffix Exception that did not extend Exception, as well as being more concise and appealing names.</li>
</ul>
</blockquote>
<p><code>E_ERROR</code> 和 <code>E_RECOVERABLE_ERROR</code> 级别的错误在 PHP7 之前是不能被捕获到的，也就是说，你无法使用 <code>try...catch...</code> 这样的语句捕获到这种级别的错误，但不管是 PHP7 还是 PHP5 对于未捕获的异常依然是一个致命错误</p>
<p>在 PHP5 中</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$object</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$object</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 结果
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">Fatal</span> <span class="nx">error</span><span class="o">:</span> <span class="nx">Call</span> <span class="nx">to</span> <span class="nx">a</span> <span class="nx">member</span> <span class="k">function</span> <span class="nf">method</span><span class="p">()</span> <span class="nx">on</span> <span class="k">null</span> <span class="nx">in</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>在 PHP7 中：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$object</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$object</span><span class="o">-&gt;</span><span class="na">method</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Error</span> <span class="nv">$error</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="nv">$error</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 结果
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">Call</span> <span class="nx">to</span> <span class="nx">a</span> <span class="nx">member</span> <span class="k">function</span> <span class="nf">method</span><span class="p">()</span> <span class="nx">on</span> <span class="k">null</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>是的，PHP7 内置了一个名为 <code>Error</code> 的类来捕获一些致命错误和异常了，其中 <code>Error</code> 和 <code>Exception</code> 类实现了 <code>Throwable</code> 接口。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="c1">// Throwable 接口
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">Throwable</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="cm">/* Methods */</span>
</span></span><span class="line"><span class="cl">    <span class="k">abstract</span> <span class="k">public</span> <span class="nx">string</span> <span class="nx">getMessage</span> <span class="p">(</span> <span class="nx">void</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">abstract</span> <span class="k">public</span> <span class="nx">int</span> <span class="nx">getCode</span> <span class="p">(</span> <span class="nx">void</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">abstract</span> <span class="k">public</span> <span class="nx">string</span> <span class="nx">getFile</span> <span class="p">(</span> <span class="nx">void</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">abstract</span> <span class="k">public</span> <span class="nx">int</span> <span class="nx">getLine</span> <span class="p">(</span> <span class="nx">void</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">abstract</span> <span class="k">public</span> <span class="k">array</span> <span class="nx">getTrace</span> <span class="p">(</span> <span class="nx">void</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">abstract</span> <span class="k">public</span> <span class="nx">string</span> <span class="nx">getTraceAsString</span> <span class="p">(</span> <span class="nx">void</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">abstract</span> <span class="k">public</span> <span class="nx">Throwable</span> <span class="nx">getPrevious</span> <span class="p">(</span> <span class="nx">void</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">abstract</span> <span class="k">public</span> <span class="nx">string</span> <span class="nx">__toString</span> <span class="p">(</span> <span class="nx">void</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="details admonition warning open">
        <div class="details-summary admonition-title">
            <i class="icon fas fa-exclamation-triangle fa-fw" aria-hidden="true"></i>警告<i class="details-icon fas fa-angle-right fa-fw" aria-hidden="true"></i>
        </div>
        <div class="details-content">
            <div class="admonition-content">开发者不能直接实现 <code>Throwable</code> 接口，必须通过 <code>Error</code> 或者 <code>Exception</code> 等类去扩展</div>
        </div>
    </div>
<p>也可以用以下的方式去扩展自己的错误和异常类。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">interface</span> <span class="nx">TestThrowable</span> <span class="k">extends</span> <span class="nx">\Throwable</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">TestException</span> <span class="k">extends</span> <span class="nx">\Exception</span> <span class="k">implements</span> <span class="nx">TestThrowable</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DemoError</span> <span class="k">extends</span> <span class="nx">\Error</span> <span class="k">implements</span> <span class="nx">TestThrowable</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="异常处理">异常处理</h2>
<p>由于 <code>Error</code> 和 <code>Exception</code> 都实现了 <code>Throwable</code> 接口，那么问题就来了，在程序中我们究竟要用哪个？通过一些最佳实践我们知道，错误一般是去约束程序员和代码语法、语义及逻辑方面的，而异常是程序在运行过程出现的一些不合期望的情况。因此，在代码中我们应当使用异常而不是错误。</p>
<p>PHP 7.2.0 - 7.2.3 版本中提供的内置异常：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="nx">Exception</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ClosedGeneratorException</span>
</span></span><span class="line"><span class="cl">  <span class="nx">DOMException</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ErrorException</span>
</span></span><span class="line"><span class="cl">  <span class="nx">IntlException</span>
</span></span><span class="line"><span class="cl">  <span class="nx">LogicException</span>
</span></span><span class="line"><span class="cl">    <span class="nx">BadFunctionCallException</span>
</span></span><span class="line"><span class="cl">      <span class="nx">BadMethodCallException</span>
</span></span><span class="line"><span class="cl">    <span class="nx">DomainException</span>
</span></span><span class="line"><span class="cl">    <span class="nx">InvalidArgumentException</span>
</span></span><span class="line"><span class="cl">    <span class="nx">LengthException</span>
</span></span><span class="line"><span class="cl">    <span class="nx">OutOfRangeException</span>
</span></span><span class="line"><span class="cl">  <span class="nx">PharException</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ReflectionException</span>
</span></span><span class="line"><span class="cl">  <span class="nx">RuntimeException</span>
</span></span><span class="line"><span class="cl">    <span class="nx">OutOfBoundsException</span>
</span></span><span class="line"><span class="cl">    <span class="nx">OverflowException</span>
</span></span><span class="line"><span class="cl">    <span class="nx">PDOException</span>
</span></span><span class="line"><span class="cl">    <span class="nx">RangeException</span>
</span></span><span class="line"><span class="cl">    <span class="nx">UnderflowException</span>
</span></span><span class="line"><span class="cl">    <span class="nx">UnexpectedValueException</span>
</span></span><span class="line"><span class="cl">  <span class="nx">SodiumException</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>兼容 PHP5 和 PHP7 的异常处理</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Code that may throw an Exception or Error.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Throwable</span> <span class="nv">$t</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Executed only in PHP 7, will not match in PHP 5.x.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Executed only in PHP 5.x, will not be reached in PHP 7.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="自定义捕获错误和异常">自定义捕获错误和异常</h3>
<ul>
<li>未捕获的 <code>Error</code> 和 <code>Exception</code> 通过 <code>set_exception_handler()</code> 做后续清理和日志记录</li>
<li>其他错误仍然通过 <code>set_error_handler()</code> 来处理，在处理的时候使用更加明确的 <code>E_*</code> 类型，并抛出 <code>ErrorException</code> 记录调用栈</li>
</ul>
<p>以下实例中使用 <code>set_error_handler()</code> 函数去捕获错误，设置一个用户自定义的错误处理函数，这里我就粗暴的抛出 了 <code>ErrorException</code> 异常，当然官方文档也明确说了这个函数不能捕获 <code>E_ERROR</code>、<code>E_PARSE</code>、<code>E_CORE_ERROR</code>、<code>E_CORE_WARNING</code>、<code>E_COMPILE_ERROR</code>、<code>E_COMPILE_WARNING</code> 和在调用 <code>set_error_handler()</code> 函数所在文件中产生的大多数 <code>E_STRICT</code> 异常，言外之语也就是仅能捕获用户定义的错误和异常。使用 <code>set_exception_handler()</code> 函数去设置默认的异常处理程序，用在没有用 <code>try/catch</code> 块来捕获的异常，也就是说不管你抛出的异常有没有人捕获，如果没有人捕获就会进入到该方法中，并且在回调函数调用后异常会中止。使用 <code>register_shutdown_function()</code> 函数去捕获 PHP 的错误：<code>Fatal or Parse Error</code> 等，正由于这个函数是 PHP 脚本执行结束前的最后一个有效调用，所以我们才用它来完成一些不可思议的事情。一般情况下，都会在这个函数的回调函数中使用 <code>error_get_last()</code> 函数来获取执行产生的错误，顺便说一下，像语法这样的错误是捕获不到的</p>
<h4 id="正常情况时的异常捕获">正常情况时的异常捕获</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ErrorHandler</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">error_reporting</span><span class="p">(</span><span class="k">E_ALL</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">set_error_handler</span><span class="p">([</span><span class="no">__CLASS__</span><span class="p">,</span> <span class="s1">&#39;handleError&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">set_exception_handler</span><span class="p">([</span><span class="no">__CLASS__</span><span class="p">,</span> <span class="s1">&#39;handleException&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">register_shutdown_function</span><span class="p">([</span><span class="no">__CLASS__</span><span class="p">,</span> <span class="s1">&#39;handleShutdown&#39;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">handleError</span><span class="p">(</span><span class="nv">$code</span><span class="p">,</span> <span class="nv">$message</span><span class="p">,</span> <span class="nv">$file</span><span class="p">,</span> <span class="nv">$line</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">throw</span> <span class="k">new</span> <span class="nx">\ErrorException</span><span class="p">(</span><span class="nv">$message</span><span class="p">,</span> <span class="nv">$code</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nv">$file</span><span class="p">,</span> <span class="nv">$line</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">handleException</span><span class="p">(</span><span class="nv">$e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">self</span><span class="o">::</span><span class="na">handle</span><span class="p">(</span><span class="nv">$e</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">handleShutdown</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$error</span> <span class="o">=</span> <span class="nx">error_get_last</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="o">!==</span> <span class="nv">$error</span> <span class="o">&amp;&amp;</span> <span class="nx">self</span><span class="o">::</span><span class="na">isFatal</span><span class="p">(</span><span class="nv">$error</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">self</span><span class="o">::</span><span class="na">handleException</span><span class="p">(</span><span class="nv">$error</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="sd">/**
</span></span></span><span class="line"><span class="cl"><span class="sd">     * @param \Exception|\Throwable $e
</span></span></span><span class="line"><span class="cl"><span class="sd">     */</span>
</span></span><span class="line"><span class="cl">    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">$e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$message</span> <span class="o">=</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">()</span> <span class="o">.</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">echo</span> <span class="nv">$message</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nx">error_log</span><span class="p">(</span><span class="nv">$message</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="no">__DIR__</span> <span class="o">.</span> <span class="s1">&#39;/run.log&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">protected</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">isFatal</span><span class="p">(</span><span class="nv">$type</span><span class="p">)</span><span class="o">:</span> <span class="nx">bool</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$types</span> <span class="o">=</span> <span class="p">[</span><span class="k">E_ERROR</span><span class="p">,</span> <span class="nx">E_CORE_ERROR</span><span class="p">,</span> <span class="nx">E_COMPILE_ERROR</span><span class="p">,</span> <span class="k">E_PARSE</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">in_array</span><span class="p">(</span><span class="nv">$type</span><span class="p">,</span> <span class="nv">$types</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">ErrorHandler</span><span class="o">::</span><span class="na">register</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$object</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$object</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 结果
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">Call</span> <span class="nx">to</span> <span class="nx">a</span> <span class="nx">member</span> <span class="k">function</span> <span class="nf">toArray</span><span class="p">()</span> <span class="nx">on</span> <span class="k">null</span>
</span></span><span class="line"><span class="cl"><span class="nx">此时错误已经记录到日志文件中</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="写错语法时的异常捕获">写错语法时的异常捕获</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 此处略去 ErrorHandler 类代码，详见上面
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">ErrorHandler</span><span class="o">::</span><span class="na">register</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$object</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 这儿故意不写分号
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nv">$object</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 结果
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">PHP</span> <span class="nx">Parse</span> <span class="nx">error</span><span class="o">:</span>  <span class="nx">syntax</span> <span class="nx">error</span><span class="p">,</span> <span class="nx">unexpected</span> <span class="nx">end</span> <span class="nx">of</span> <span class="nx">file</span> <span class="nx">in</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="nx">PHP</span>
</span></span><span class="line"><span class="cl"><span class="nx">PHP</span> <span class="nx">Dump</span> <span class="nv">$_SERVER</span>
</span></span><span class="line"><span class="cl"><span class="nx">PHP</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">Parse</span> <span class="nx">error</span><span class="o">:</span> <span class="nx">syntax</span> <span class="nx">error</span><span class="p">,</span> <span class="nx">unexpected</span> <span class="nx">end</span> <span class="nx">of</span> <span class="nx">file</span> <span class="nx">in</span> <span class="o">...</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>事情进展到这里，按理来说，我应该就此停笔收尾，弄个总结之类的一忽悠一下正在阅读的你。但是呢，我又忽然想起来 PHP 那么多的框架是如何处理这个事情的，我想你也好奇，不妨我们去看看</p>
<h3 id="框架中的错误异常处理">框架中的错误异常处理</h3>
<p>很遗憾的告诉你，我不会剖析框架源码，我只想做个 <code>demo</code> 得瑟一下，剩下全交给你。此处我以 <code>symfony debug</code> 为例</p>
<blockquote>
<ul>
<li><a href="https://github.com/symfony/debug" target="_blank" rel="noopener noreffer">Symfony debug GitHub</a></li>
<li><a href="https://symfony.com/components/Debug" target="_blank" rel="noopener noreffer">Symfony debug Docs</a></li>
</ul>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">// 安装 symfony/debug
</span></span><span class="line"><span class="cl">$ composer require symfony/debug
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-php" data-lang="php"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="nx">php</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">require</span> <span class="no">__DIR__</span> <span class="o">.</span> <span class="s1">&#39;/vendor/autoload.php&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">\Symfony\Component\Debug\Debug</span><span class="o">::</span><span class="na">enable</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nx">\Symfony\Component\Debug\ErrorHandler</span><span class="o">::</span><span class="na">register</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$object</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$object</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img
        class="lazyload"
        src="https://imajinyun.xyz/svg/loading.min.svg"
        data-src="https://inotes.oss-cn-beijing.aliyuncs.com/php/201812/php-error-exception-handler.png"
        data-srcset="https://inotes.oss-cn-beijing.aliyuncs.com/php/201812/php-error-exception-handler.png, https://inotes.oss-cn-beijing.aliyuncs.com/php/201812/php-error-exception-handler.png 1.5x, https://inotes.oss-cn-beijing.aliyuncs.com/php/201812/php-error-exception-handler.png 2x"
        data-sizes="auto"
        alt="https://inotes.oss-cn-beijing.aliyuncs.com/php/201812/php-error-exception-handler.png"
        title="php-error-exception-handler.png" /></p></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2018-04-05</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="分享到 Twitter" data-sharer="twitter" data-url="https://imajinyun.xyz/posts/php-error-exception-handler/" data-title="PHP 中的错误和异常处理" data-hashtags="PHP"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="分享到 Facebook" data-sharer="facebook" data-url="https://imajinyun.xyz/posts/php-error-exception-handler/" data-hashtag="PHP"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="分享到 Hacker News" data-sharer="hackernews" data-url="https://imajinyun.xyz/posts/php-error-exception-handler/" data-title="PHP 中的错误和异常处理"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="分享到 Line" data-sharer="line" data-url="https://imajinyun.xyz/posts/php-error-exception-handler/" data-title="PHP 中的错误和异常处理"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@7.0.0/icons/line.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="https://imajinyun.xyz/posts/php-error-exception-handler/" data-title="PHP 中的错误和异常处理"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="https://imajinyun.xyz/tags/php/">PHP</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="https://imajinyun.xyz/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="https://imajinyun.xyz/posts/php-highlight/" class="prev" rel="prev" title="PHP - 输出中的代码语法高亮"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>PHP - 输出中的代码语法高亮</a>
            <a href="https://imajinyun.xyz/posts/php-date-calculation/" class="next" rel="next" title="PHP - 日期相关计算">PHP - 日期相关计算<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.100.1">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2018 - 2022</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://imajinyun.xyz/" target="_blank"></a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script><script type="text/javascript" src="https://imajinyun.xyz/lib/lunr/lunr.stemmer.support.min.js"></script><script type="text/javascript" src="https://imajinyun.xyz/lib/lunr/lunr.zh.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":50},"comment":{},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","lunrLanguageCode":"zh","lunrSegmentitURL":"/lib/lunr/lunr.segmentit.js","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":30,"type":"lunr"}};</script><script type="text/javascript" src="https://imajinyun.xyz/js/theme.min.js"></script></body>
</html>
