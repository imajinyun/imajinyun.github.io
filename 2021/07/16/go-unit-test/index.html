<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Go 单元测试 - Jinyun's Notes</title><meta name=Description content="进一寸有进一寸的欢喜，退一步有退一步的从容"><meta property="og:title" content="Go 单元测试"><meta property="og:description" content="Go 语言从开发初期就注意了测试用例的编写。特别是静态语言，由于调试没有动态语言那么方便，所以能最快最方便地编写一个测试用例就显得非常重要了。"><meta property="og:type" content="article"><meta property="og:url" content="https://imajinyun.xyz/2021/07/16/go-unit-test/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-07-16T08:43:26+08:00"><meta property="article:modified_time" content="2021-07-16T08:43:26+08:00"><meta property="og:site_name" content="Jinyun's Notes"><meta property="og:see_also" content="https://imajinyun.xyz/2022/06/20/go-grpc/"><meta property="og:see_also" content="https://imajinyun.xyz/2021/07/25/go-concat-string/"><meta property="og:see_also" content="https://imajinyun.xyz/2021/07/24/go-correct-posture/"><meta property="og:see_also" content="https://imajinyun.xyz/2021/07/22/go-other-test/"><meta property="og:see_also" content="https://imajinyun.xyz/2021/07/17/go-benchmark-test/"><meta name=twitter:card content="summary"><meta name=twitter:title content="Go 单元测试"><meta name=twitter:description content="Go 语言从开发初期就注意了测试用例的编写。特别是静态语言，由于调试没有动态语言那么方便，所以能最快最方便地编写一个测试用例就显得非常重要了。"><meta name=application-name content="进一寸有进一寸的欢喜，退一步有退一步的从容"><meta name=apple-mobile-web-app-title content="进一寸有进一寸的欢喜，退一步有退一步的从容"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel=icon href=https://inotes.oss-cn-beijing.aliyuncs.com/common/201812/logo.svg><link rel=apple-touch-icon sizes=180x180 href=https://imajinyun.xyz/apple-touch-icon.png><link rel=mask-icon href=https://imajinyun.xyz/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=https://imajinyun.xyz/site.webmanifest><link rel=canonical href=https://imajinyun.xyz/2021/07/16/go-unit-test/><link rel=prev href=https://imajinyun.xyz/2021/07/14/go-random-number/><link rel=next href=https://imajinyun.xyz/2021/07/17/go-benchmark-test/><link rel=stylesheet href=https://imajinyun.xyz/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Go 单元测试","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/imajinyun.xyz\/2021\/07\/16\/go-unit-test\/"},"genre":"posts","keywords":"Go","wordcount":3356,"url":"https:\/\/imajinyun.xyz\/2021\/07\/16\/go-unit-test\/","datePublished":"2021-07-16T08:43:26+08:00","dateModified":"2021-07-16T08:43:26+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"作者"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=https://imajinyun.xyz/ title="Jinyun's Notes"><span class=header-title-pre><i class='fa fa-charging-station'></i></span>Jinyun's Notes</a></div><div class=menu><div class=menu-inner><a class=menu-item href=https://imajinyun.xyz/posts/><i class='fa-solid fa-sun'></i> 笔记 </a><a class=menu-item href=https://imajinyun.xyz/tags/><i class='fa-solid fa-tags'></i> 标签 </a><a class=menu-item href=https://imajinyun.xyz/categories/><i class='fa-solid fa-layer-group'></i> 分类 </a><a class=menu-item href=https://imajinyun.xyz/docs/><i class='fa-solid fa-file-word'></i> 文档 </a><a class=menu-item href=https://imajinyun.xyz/links/><i class='fa fa-link'></i> 友链 </a><a class=menu-item href=https://imajinyun.xyz/about/><i class='fa fa-paper-plane'></i> 关于 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=https://imajinyun.xyz/ title="Jinyun's Notes"><span class=header-title-pre><i class='fa fa-charging-station'></i></span>Jinyun's Notes</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=https://imajinyun.xyz/posts/ title><i class='fa-solid fa-sun'></i>笔记</a><a class=menu-item href=https://imajinyun.xyz/tags/ title><i class='fa-solid fa-tags'></i>标签</a><a class=menu-item href=https://imajinyun.xyz/categories/ title><i class='fa-solid fa-layer-group'></i>分类</a><a class=menu-item href=https://imajinyun.xyz/docs/ title><i class='fa-solid fa-file-word'></i>文档</a><a class=menu-item href=https://imajinyun.xyz/links/ title><i class='fa fa-link'></i>友链</a><a class=menu-item href=https://imajinyun.xyz/about/ title><i class='fa fa-paper-plane'></i>关于</a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Go 单元测试</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://imajinyun.xyz/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>作者</a></span>&nbsp;<span class=post-category>收录于 <a href=https://imajinyun.xyz/categories/go/><i class="far fa-folder fa-fw" aria-hidden=true></i>Go</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2021-07-16>2021-07-16</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;约 3356 字&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;预计阅读 7 分钟&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#单元测试命令>单元测试命令</a><ul><li><a href=#单元测试命令实例>单元测试命令实例</a></li><li><a href=#一些测试选项>一些测试选项</a></li></ul></li><li><a href=#单元测试函数>单元测试函数</a><ul><li><a href=#单元测试函数格式>单元测试函数格式</a></li><li><a href=#各种不同测试用例>各种不同测试用例</a></li></ul></li><li><a href=#单元测试用例>单元测试用例</a><ul><li><a href=#基本测试实例>基本测试实例</a></li><li><a href=#表驱动测试实例>表驱动测试实例</a></li><li><a href=#子测试实例>子测试实例</a></li><li><a href=#模仿测试实例>模仿测试实例</a></li></ul></li><li><a href=#t-类型>T 类型</a><ul><li><a href=#报告方法>报告方法</a><ul><li><a href=#错误方法>错误方法</a></li><li><a href=#失败方法>失败方法</a></li><li><a href=#致命方法>致命方法</a></li><li><a href=#日志方法>日志方法</a></li><li><a href=#跳过方法>跳过方法</a></li></ul></li><li><a href=#并行测试>并行测试</a></li></ul></li></ul></nav></div></div><div class=content id=content><p>Go 语言从开发初期就注意了测试用例的编写。特别是静态语言，由于调试没有动态语言那么方便，所以能最快最方便地编写一个测试用例就显得非常重要了。</p><ul><li><a href=https://imajinyun.xyz/2021/06/26/go-get-started/ target=_blank rel="noopener noreffer">Go 起步</a></li><li><a href=https://imajinyun.xyz/2021/07/02/go-data-type/ target=_blank rel="noopener noreffer">Go 数据类型</a></li><li><a href=https://imajinyun.xyz/2021/07/11/go-date-time/ target=_blank rel="noopener noreffer">Go 日期时间</a></li><li><a href=https://imajinyun.xyz/2021/07/14/go-random-number/ target=_blank rel="noopener noreffer">Go 随机数</a></li><li><strong>Go 单元测试</strong></li><li><a href=https://imajinyun.xyz/2021/07/17/go-benchmark-test/ target=_blank rel="noopener noreffer">Go 基准测试</a></li><li><a href=https://imajinyun.xyz/2021/07/22/go-other-test/ target=_blank rel="noopener noreffer">Go 其它测试</a></li><li><a href=https://imajinyun.xyz/2021/07/24/go-correct-posture/ target=_blank rel="noopener noreffer">Go 正确姿势</a></li><li><a href=https://imajinyun.xyz/2021/07/25/go-concat-string/ target=_blank rel="noopener noreffer">Go 连接字符串</a></li></ul><h2 id=单元测试命令>单元测试命令</h2><h3 id=单元测试命令实例>单元测试命令实例</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ go <span class=nb>test</span> -v hello.go hello_test.go
</span></span><span class=line><span class=cl>$ go <span class=nb>test</span> -v .
</span></span><span class=line><span class=cl>$ go <span class=nb>test</span> -v -run TestFib .
</span></span><span class=line><span class=cl>$ go <span class=nb>test</span> -v -timeout 30s -run <span class=s1>&#39;^TestFib$&#39;</span> example.com/hello .
</span></span></code></pre></td></tr></table></div></div><h3 id=一些测试选项>一些测试选项</h3><ul><li><code>-bench regexp</code>：执行相应的 <code>benchmarks</code>，例如：<code>-bench=.</code>；</li><li><code>-cover</code>：开户测试覆盖率；</li><li><code>-run regexp</code>：只运行 <code>regexp</code> 匹配的函数，例如：<code>-run=Array</code> 仅执行包含有 <code>Array</code> 开头的函数；</li><li><code>-v</code>：显示测试的详细命令；</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ go <span class=nb>test</span> -v -timeout 10s -run <span class=s1>&#39;^TestFib$&#39;</span> example.com/hello .
</span></span><span class=line><span class=cl><span class=o>===</span> RUN   TestFib
</span></span><span class=line><span class=cl>--- PASS: TestFib <span class=o>(</span>0.00s<span class=o>)</span>
</span></span><span class=line><span class=cl>PASS
</span></span><span class=line><span class=cl>ok      example.com/hello       0.006s
</span></span></code></pre></td></tr></table></div></div><h2 id=单元测试函数>单元测试函数</h2><h3 id=单元测试函数格式>单元测试函数格式</h3><div class="details admonition warning open"><div class="details-summary admonition-title"><i class="icon fas fa-exclamation-triangle fa-fw" aria-hidden=true></i>警告<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content><code>TestXxx</code> 中 <code>Xxx</code> 可以是任何字母数字字符串，但是第一个字母不能是小写字母。</div></div></div><p>单元测试源码文件可以由多个测试用例组成，每个测试用例函数需要以 <code>Test</code> 为前缀：</p><ul><li>前缀用例文件不会参与正常源码编译，不会被包含到可执行文件中；</li><li>单元测试用例使用 <code>go test</code> 指令来执行，没有也不需要 <code>main()</code> 作为函数入口。所有以 <code>_test</code> 结尾的源码内以 <code>Test</code> 开头的函数会被自动执行；</li><li>单元测试函数的参数 <code>t *test.T</code> 必须传入，否则会报函数签名错误，即：<code>wrong signature for TestXxx, must be: func TestXxx(t *testing.T)</code>；</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>TestXxx</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 以下命名是合法的
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>Test123</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>Test中国</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>TestMac</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>要编写一个新的测试套件，需要创建一个名称以 <code>_test.go</code> 结尾的文件，该文件包含 <code>TestXxx</code> 函数。</p><h3 id=各种不同测试用例>各种不同测试用例</h3><ul><li><code>TestSomething(t *testing.T)</code>：基本测试用例；</li><li><code>BenchmarkSomething(b *testing.B)</code>：基准测试用例；</li><li><code>ExampleSomething()</code>：控制台测试用例；</li><li><code>TestMain(m *testing.M)</code>：主函数测试用例；</li></ul><h2 id=单元测试用例>单元测试用例</h2><h3 id=基本测试实例>基本测试实例</h3><p>待测代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>Fib</span><span class=p>(</span><span class=nx>n</span> <span class=kt>int</span><span class=p>)</span> <span class=kt>int</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=nx>n</span> <span class=p>&lt;</span> <span class=mi>2</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>n</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nf>Fib</span><span class=p>(</span><span class=nx>n</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=o>+</span> <span class=nf>Fib</span><span class=p>(</span><span class=nx>n</span><span class=o>-</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>测试代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>TestFib</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>in</span> <span class=p>=</span> <span class=mi>7</span>
</span></span><span class=line><span class=cl>    <span class=nx>expect</span> <span class=p>=</span> <span class=mi>13</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>actual</span> <span class=o>:=</span> <span class=nf>Fib</span><span class=p>(</span><span class=nx>in</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=nx>actual</span> <span class=o>!=</span> <span class=nx>expect</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>t</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;Fib(%d) = %d; want %d&#34;</span><span class=p>,</span> <span class=nx>in</span><span class=p>,</span> <span class=nx>actual</span><span class=p>,</span> <span class=nx>expect</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ go <span class=nb>test</span> -v -timeout 30s -run <span class=s1>&#39;^TestFib$&#39;</span> example.com/hello
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>===</span> RUN   TestFib
</span></span><span class=line><span class=cl>--- PASS: TestFib <span class=o>(</span>0.00s<span class=o>)</span>
</span></span><span class=line><span class=cl>PASS
</span></span><span class=line><span class=cl>ok  	example.com/hello	0.007s
</span></span></code></pre></td></tr></table></div></div><h3 id=表驱动测试实例>表驱动测试实例</h3><p>Table-Driven 的测试方式在 Go 的源码中司空见惯，比如：<a href=https://github.com/golang/go/blob/master/src/time/time_test.go target=_blank rel="noopener noreffer">time_test.go</a>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>TestFib</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>fibTests</span> <span class=p>=</span> <span class=p>[]</span><span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>in</span>     <span class=kt>int</span>
</span></span><span class=line><span class=cl>    <span class=nx>expect</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl>  <span class=p>}{</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=mi>2</span><span class=p>,</span> <span class=mi>1</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=mi>3</span><span class=p>,</span> <span class=mi>2</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=mi>4</span><span class=p>,</span> <span class=mi>3</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=mi>5</span><span class=p>,</span> <span class=mi>5</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=mi>6</span><span class=p>,</span> <span class=mi>8</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=mi>7</span><span class=p>,</span> <span class=mi>13</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=mi>8</span><span class=p>,</span> <span class=mi>21</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=mi>9</span><span class=p>,</span> <span class=mi>34</span><span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=nx>i</span><span class=p>,</span> <span class=nx>tt</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>fibTests</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>actual</span> <span class=o>:=</span> <span class=nf>Fib</span><span class=p>(</span><span class=nx>tt</span><span class=p>.</span><span class=nx>in</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>actual</span> <span class=o>!=</span> <span class=nx>tt</span><span class=p>.</span><span class=nx>expect</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>t</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;#%d: Fib(%d) = %d; want %d&#34;</span><span class=p>,</span> <span class=nx>i</span><span class=p>,</span> <span class=nx>tt</span><span class=p>.</span><span class=nx>in</span><span class=p>,</span> <span class=nx>actual</span><span class=p>,</span> <span class=nx>tt</span><span class=p>.</span><span class=nx>expect</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ go <span class=nb>test</span> -v -timeout 30s -run <span class=s1>&#39;^TestFib$&#39;</span> example.com/hello
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>===</span> RUN   TestFib
</span></span><span class=line><span class=cl>--- PASS: TestFib <span class=o>(</span>0.00s<span class=o>)</span>
</span></span><span class=line><span class=cl>PASS
</span></span><span class=line><span class=cl>ok  	example.com/hello	<span class=o>(</span>cached<span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=子测试实例>子测试实例</h3><p>待测代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>hello</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>Add</span><span class=p>(</span><span class=nx>x</span><span class=p>,</span> <span class=nx>y</span> <span class=kt>int</span><span class=p>)</span> <span class=kt>int</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>x</span> <span class=o>+</span> <span class=nx>y</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>测试代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>hello</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;testing&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>TestAll</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>positiveNumberTests</span> <span class=p>=</span> <span class=p>[]</span><span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>name</span>           <span class=kt>string</span>
</span></span><span class=line><span class=cl>    <span class=nx>x</span><span class=p>,</span> <span class=nx>y</span><span class=p>,</span> <span class=nx>expected</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl>  <span class=p>}{</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=s>&#34;positive number&#34;</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=s>&#34;negative number&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>9</span><span class=p>,</span> <span class=mi>9</span><span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span><span class=s>&#34;zero number&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>tt</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>positiveNumberTests</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>t</span><span class=p>.</span><span class=nf>Run</span><span class=p>(</span><span class=nx>tt</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=nx>actual</span> <span class=o>:=</span> <span class=nf>Add</span><span class=p>(</span><span class=nx>tt</span><span class=p>.</span><span class=nx>x</span><span class=p>,</span> <span class=nx>tt</span><span class=p>.</span><span class=nx>y</span><span class=p>);</span> <span class=nx>actual</span> <span class=o>!=</span> <span class=nx>tt</span><span class=p>.</span><span class=nx>expected</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>t</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;Add(%d, %d) = %d, want %d&#34;</span><span class=p>,</span> <span class=nx>tt</span><span class=p>.</span><span class=nx>x</span><span class=p>,</span> <span class=nx>tt</span><span class=p>.</span><span class=nx>y</span><span class=p>,</span> <span class=nx>actual</span><span class=p>,</span> <span class=nx>tt</span><span class=p>.</span><span class=nx>expected</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ go <span class=nb>test</span> -v -timeout 30s -run <span class=s1>&#39;^TestAll$&#39;</span> example.com/hello
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>===</span> RUN   <span class=nv>TestAll</span>
</span></span><span class=line><span class=cl><span class=o>===</span> RUN   TestAll/positive_number
</span></span><span class=line><span class=cl><span class=o>===</span> RUN   TestAll/negative_number
</span></span><span class=line><span class=cl><span class=o>===</span> RUN   TestAll/zero_number
</span></span><span class=line><span class=cl>--- PASS: TestAll <span class=o>(</span>0.00s<span class=o>)</span>
</span></span><span class=line><span class=cl>    --- PASS: TestAll/positive_number <span class=o>(</span>0.00s<span class=o>)</span>
</span></span><span class=line><span class=cl>    --- PASS: TestAll/negative_number <span class=o>(</span>0.00s<span class=o>)</span>
</span></span><span class=line><span class=cl>    --- PASS: TestAll/zero_number <span class=o>(</span>0.00s<span class=o>)</span>
</span></span><span class=line><span class=cl>PASS
</span></span><span class=line><span class=cl>ok  	example.com/hello	0.013s
</span></span></code></pre></td></tr></table></div></div><h3 id=模仿测试实例>模仿测试实例</h3><p>待测代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>hello</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>API</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nf>FetchPostByID</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>id</span> <span class=kt>int</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>APIPost</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>APIPost</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>ID</span>     <span class=kt>int</span>    <span class=s>`json:&#34;id&#34;`</span>
</span></span><span class=line><span class=cl>  <span class=nx>UserID</span> <span class=kt>int</span>    <span class=s>`json:&#34;user_id&#34;`</span>
</span></span><span class=line><span class=cl>  <span class=nx>Title</span>  <span class=kt>string</span> <span class=s>`json:&#34;title&#34;`</span>
</span></span><span class=line><span class=cl>  <span class=nx>Body</span>   <span class=kt>string</span> <span class=s>`json:&#34;body&#34;`</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>测试代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>hello</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>  <span class=s>&#34;encoding/json&#34;</span>
</span></span><span class=line><span class=cl>  <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>  <span class=s>&#34;io&#34;</span>
</span></span><span class=line><span class=cl>  <span class=s>&#34;net/http&#34;</span>
</span></span><span class=line><span class=cl>  <span class=s>&#34;reflect&#34;</span>
</span></span><span class=line><span class=cl>  <span class=s>&#34;strings&#34;</span>
</span></span><span class=line><span class=cl>  <span class=s>&#34;testing&#34;</span>
</span></span><span class=line><span class=cl>  <span class=s>&#34;time&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>APIMock</span> <span class=kd>struct</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>a</span> <span class=o>*</span><span class=nx>APIMock</span><span class=p>)</span> <span class=nf>FetchPostByID</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>id</span> <span class=kt>int</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>APIPost</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nf>StatusText</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusNotFound</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>HTTPClient</span> <span class=kd>interface</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nf>Do</span><span class=p>(</span><span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Response</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>HTTPClientMock</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>DoFunc</span> <span class=kd>func</span><span class=p>(</span><span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Response</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>h</span> <span class=nx>HTTPClientMock</span><span class=p>)</span> <span class=nf>Do</span><span class=p>(</span><span class=nx>r</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Response</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>h</span><span class=p>.</span><span class=nf>DoFunc</span><span class=p>(</span><span class=nx>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>New</span><span class=p>(</span><span class=nx>client</span> <span class=nx>HTTPClient</span><span class=p>,</span> <span class=nx>baseURL</span> <span class=kt>string</span><span class=p>,</span> <span class=nx>timeout</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Duration</span><span class=p>)</span> <span class=nx>API</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=o>&amp;</span><span class=nx>v1</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>c</span><span class=p>:</span>       <span class=nx>client</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>baseURL</span><span class=p>:</span> <span class=nx>baseURL</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>timeout</span><span class=p>:</span> <span class=nx>timeout</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>v1</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>c</span>       <span class=nx>HTTPClient</span>
</span></span><span class=line><span class=cl>  <span class=nx>baseURL</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>  <span class=nx>timeout</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Duration</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>v</span> <span class=nx>v1</span><span class=p>)</span> <span class=nf>FetchPostByID</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>id</span> <span class=kt>int</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>APIPost</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>u</span> <span class=o>:=</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;%s/posts/%d&#34;</span><span class=p>,</span> <span class=nx>v</span><span class=p>.</span><span class=nx>baseURL</span><span class=p>,</span> <span class=nx>id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>ctx</span><span class=p>,</span> <span class=nx>cancel</span> <span class=o>:=</span> <span class=nx>context</span><span class=p>.</span><span class=nf>WithTimeout</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>v</span><span class=p>.</span><span class=nx>timeout</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>defer</span> <span class=nf>cancel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>req</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>http</span><span class=p>.</span><span class=nf>NewRequestWithContext</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>http</span><span class=p>.</span><span class=nx>MethodGet</span><span class=p>,</span> <span class=nx>u</span><span class=p>,</span> <span class=kc>nil</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>res</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>v</span><span class=p>.</span><span class=nx>c</span><span class=p>.</span><span class=nf>Do</span><span class=p>(</span><span class=nx>req</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>defer</span> <span class=nx>res</span><span class=p>.</span><span class=nx>Body</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=nx>res</span><span class=p>.</span><span class=nx>StatusCode</span> <span class=o>!=</span> <span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nf>StatusText</span><span class=p>(</span><span class=nx>res</span><span class=p>.</span><span class=nx>StatusCode</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>result</span> <span class=o>*</span><span class=nx>APIPost</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>result</span><span class=p>,</span> <span class=nx>json</span><span class=p>.</span><span class=nf>NewDecoder</span><span class=p>(</span><span class=nx>res</span><span class=p>.</span><span class=nx>Body</span><span class=p>).</span><span class=nf>Decode</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>result</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=nx>client</span> <span class=p>=</span> <span class=o>&amp;</span><span class=nx>HTTPClientMock</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>  <span class=nx>api</span>    <span class=p>=</span> <span class=nf>New</span><span class=p>(</span><span class=nx>client</span><span class=p>,</span> <span class=s>&#34;&#34;</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>TestV1FetchPostByID</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>postTests</span> <span class=o>:=</span> <span class=p>[]</span><span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Body</span>       <span class=kt>string</span>
</span></span><span class=line><span class=cl>    <span class=nx>StatusCode</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl>    <span class=nx>Result</span>     <span class=o>*</span><span class=nx>APIPost</span>
</span></span><span class=line><span class=cl>    <span class=nx>Error</span>      <span class=kt>error</span>
</span></span><span class=line><span class=cl>  <span class=p>}{</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>Body</span><span class=p>:</span>       <span class=s>`{&#34;id&#34;:1,&#34;user_id&#34;:1001,&#34;title&#34;:&#34;title 1&#34;,&#34;body&#34;:&#34;body 1&#34;}`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>StatusCode</span><span class=p>:</span> <span class=mi>200</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>Result</span><span class=p>:</span>     <span class=o>&amp;</span><span class=nx>APIPost</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1001</span><span class=p>,</span> <span class=s>&#34;title 1&#34;</span><span class=p>,</span> <span class=s>&#34;body 1&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nx>Error</span><span class=p>:</span>      <span class=kc>nil</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>Body</span><span class=p>:</span>       <span class=s>`{&#34;id&#34;:2,&#34;user_id&#34;:1002,&#34;title&#34;:&#34;title 2&#34;,&#34;body&#34;:&#34;body 2&#34;}`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>StatusCode</span><span class=p>:</span> <span class=mi>200</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>Result</span><span class=p>:</span>     <span class=o>&amp;</span><span class=nx>APIPost</span><span class=p>{</span><span class=mi>2</span><span class=p>,</span> <span class=mi>1002</span><span class=p>,</span> <span class=s>&#34;title 2&#34;</span><span class=p>,</span> <span class=s>&#34;body 2&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nx>Error</span><span class=p>:</span>      <span class=kc>nil</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>Body</span><span class=p>:</span>       <span class=s>``</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>StatusCode</span><span class=p>:</span> <span class=nx>http</span><span class=p>.</span><span class=nx>StatusBadRequest</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>Result</span><span class=p>:</span>     <span class=kc>nil</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>Error</span><span class=p>:</span>      <span class=nx>fmt</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nf>StatusText</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusBadRequest</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>Body</span><span class=p>:</span>       <span class=s>``</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>StatusCode</span><span class=p>:</span> <span class=nx>http</span><span class=p>.</span><span class=nx>StatusBadRequest</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>Result</span><span class=p>:</span>     <span class=kc>nil</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>Error</span><span class=p>:</span>      <span class=nx>fmt</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nf>StatusText</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusBadRequest</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>tt</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>postTests</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>client</span><span class=p>.</span><span class=nx>DoFunc</span> <span class=p>=</span> <span class=kd>func</span><span class=p>(</span><span class=nx>r</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Response</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=o>&amp;</span><span class=nx>http</span><span class=p>.</span><span class=nx>Response</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>Body</span><span class=p>:</span>       <span class=nx>io</span><span class=p>.</span><span class=nf>NopCloser</span><span class=p>(</span><span class=nx>strings</span><span class=p>.</span><span class=nf>NewReader</span><span class=p>(</span><span class=nx>tt</span><span class=p>.</span><span class=nx>Body</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>        <span class=nx>StatusCode</span><span class=p>:</span> <span class=nx>tt</span><span class=p>.</span><span class=nx>StatusCode</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>post</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>api</span><span class=p>.</span><span class=nf>FetchPostByID</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nf>Background</span><span class=p>(),</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=o>&amp;&amp;</span> <span class=nx>err</span><span class=p>.</span><span class=nf>Error</span><span class=p>()</span> <span class=o>!=</span> <span class=nx>tt</span><span class=p>.</span><span class=nx>Error</span><span class=p>.</span><span class=nf>Error</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>t</span><span class=p>.</span><span class=nf>Fatalf</span><span class=p>(</span><span class=s>&#34;want %v, got %v&#34;</span><span class=p>,</span> <span class=nx>tt</span><span class=p>.</span><span class=nx>Error</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>!</span><span class=nx>reflect</span><span class=p>.</span><span class=nf>DeepEqual</span><span class=p>(</span><span class=nx>post</span><span class=p>,</span> <span class=nx>tt</span><span class=p>.</span><span class=nx>Result</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>t</span><span class=p>.</span><span class=nf>Fatalf</span><span class=p>(</span><span class=s>&#34;want %v, got %v&#34;</span><span class=p>,</span> <span class=nx>tt</span><span class=p>.</span><span class=nx>Result</span><span class=p>,</span> <span class=nx>post</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ go <span class=nb>test</span> -v -timeout 30s -run <span class=s1>&#39;^TestV1FetchPostByID$&#39;</span> example.com/hello
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>===</span> RUN   TestV1FetchPostByID
</span></span><span class=line><span class=cl>--- PASS: TestV1FetchPostByID <span class=o>(</span>0.00s<span class=o>)</span>
</span></span><span class=line><span class=cl>PASS
</span></span><span class=line><span class=cl>ok  	example.com/hello	<span class=o>(</span>cached<span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=t-类型>T 类型</h2><p>单元测试中，传递给测试函数的参数是 <code>*testing.T</code> 类型。它用于管理测试状态并支持格式化测试日志。测试日志会在执行测试的过程中不断累积，并在测试完成时转储至标准输出。</p><h3 id=报告方法>报告方法</h3><h4 id=错误方法>错误方法</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>hello</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=s>&#34;errors&#34;</span>
</span></span><span class=line><span class=cl>  <span class=s>&#34;testing&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>TestErrorFunc</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>t</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=s>&#34;this is a error&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>t</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;%s&#34;</span><span class=p>,</span> <span class=nx>errors</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=s>&#34;this is a error&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ go <span class=nb>test</span> -v -timeout 30s -run <span class=s1>&#39;^TestErrorFunc$&#39;</span> example.com/hello
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>===</span> RUN   TestErrorFunc
</span></span><span class=line><span class=cl>    /Users/majinyun/Codes/go/src/github.com/imajinyun/hello/hello_test.go:9: this is a error
</span></span><span class=line><span class=cl>    /Users/majinyun/Codes/go/src/github.com/imajinyun/hello/hello_test.go:10: this is a error
</span></span><span class=line><span class=cl>--- FAIL: TestErrorFunc <span class=o>(</span>0.00s<span class=o>)</span>
</span></span><span class=line><span class=cl>FAIL
</span></span><span class=line><span class=cl>FAIL	example.com/hello	0.010s
</span></span></code></pre></td></tr></table></div></div><h4 id=失败方法>失败方法</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>hello</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=s>&#34;testing&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>TestFailFunc</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>t</span><span class=p>.</span><span class=nf>Fail</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=nx>t</span><span class=p>.</span><span class=nf>Log</span><span class=p>(</span><span class=s>&#34;see if this line will output #1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>TestFailedFunc</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>t</span><span class=p>.</span><span class=nf>Failed</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=nx>t</span><span class=p>.</span><span class=nf>Log</span><span class=p>(</span><span class=s>&#34;see if this line will output #2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>TestFailNowFunc</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>t</span><span class=p>.</span><span class=nf>FailNow</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=nx>t</span><span class=p>.</span><span class=nf>Log</span><span class=p>(</span><span class=s>&#34;see if this line will output #3&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ go <span class=nb>test</span> -v -timeout 30s -run <span class=s1>&#39;^(TestFailFunc|TestFailedFunc|TestFailNowFunc)$&#39;</span> example.com/hello
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>===</span> RUN   TestFailFunc
</span></span><span class=line><span class=cl>    /Users/majinyun/Codes/go/src/github.com/imajinyun/hello/hello_test.go:9: see <span class=k>if</span> this line will output <span class=c1>#1</span>
</span></span><span class=line><span class=cl>--- FAIL: TestFailFunc <span class=o>(</span>0.00s<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>===</span> RUN   TestFailedFunc
</span></span><span class=line><span class=cl>    /Users/majinyun/Codes/go/src/github.com/imajinyun/hello/hello_test.go:14: see <span class=k>if</span> this line will output <span class=c1>#2</span>
</span></span><span class=line><span class=cl>--- PASS: TestFailedFunc <span class=o>(</span>0.00s<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>===</span> RUN   TestFailNowFunc
</span></span><span class=line><span class=cl>--- FAIL: TestFailNowFunc <span class=o>(</span>0.00s<span class=o>)</span>
</span></span><span class=line><span class=cl>FAIL
</span></span><span class=line><span class=cl>FAIL	example.com/hello	0.008s
</span></span></code></pre></td></tr></table></div></div><h4 id=致命方法>致命方法</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>hello</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=s>&#34;errors&#34;</span>
</span></span><span class=line><span class=cl>  <span class=s>&#34;testing&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>TestFatalFunc</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>t</span><span class=p>.</span><span class=nf>Fatal</span><span class=p>(</span><span class=s>&#34;this is a fatal&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>t</span><span class=p>.</span><span class=nf>Log</span><span class=p>(</span><span class=s>&#34;see if this line will output #1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>TestFatalfFunc</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>t</span><span class=p>.</span><span class=nf>Fatalf</span><span class=p>(</span><span class=s>&#34;%s&#34;</span><span class=p>,</span> <span class=nx>errors</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=s>&#34;this is a fatal&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=nx>t</span><span class=p>.</span><span class=nf>Log</span><span class=p>(</span><span class=s>&#34;see if this line will output #2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ go <span class=nb>test</span> -v -timeout 30s -run <span class=s1>&#39;^(TestFatalFunc|TestFatalfFunc)$&#39;</span> example.com/hello
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>===</span> RUN   TestFatalFunc
</span></span><span class=line><span class=cl>    /Users/majinyun/Codes/go/src/github.com/imajinyun/hello/hello_test.go:9: this is a fatal
</span></span><span class=line><span class=cl>--- FAIL: TestFatalFunc <span class=o>(</span>0.00s<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>===</span> RUN   TestFatalfFunc
</span></span><span class=line><span class=cl>    /Users/majinyun/Codes/go/src/github.com/imajinyun/hello/hello_test.go:14: this is a fatal
</span></span><span class=line><span class=cl>--- FAIL: TestFatalfFunc <span class=o>(</span>0.00s<span class=o>)</span>
</span></span><span class=line><span class=cl>FAIL
</span></span><span class=line><span class=cl>FAIL	example.com/hello	0.012s
</span></span></code></pre></td></tr></table></div></div><h4 id=日志方法>日志方法</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>hello</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=s>&#34;errors&#34;</span>
</span></span><span class=line><span class=cl>  <span class=s>&#34;testing&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>TestLogFunc</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>t</span><span class=p>.</span><span class=nf>Log</span><span class=p>(</span><span class=s>&#34;this is a log&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>TestLogfFunc</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>t</span><span class=p>.</span><span class=nf>Logf</span><span class=p>(</span><span class=s>&#34;%s&#34;</span><span class=p>,</span> <span class=nx>errors</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=s>&#34;this is a log&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ go <span class=nb>test</span> -v -timeout 30s -run <span class=s1>&#39;^(TestLogFunc|TestLogfFunc)$&#39;</span> example.com/hello
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>===</span> RUN   TestLogFunc
</span></span><span class=line><span class=cl>    /Users/majinyun/Codes/go/src/github.com/imajinyun/hello/hello_test.go:9: this is a log
</span></span><span class=line><span class=cl>--- PASS: TestLogFunc <span class=o>(</span>0.00s<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>===</span> RUN   TestLogfFunc
</span></span><span class=line><span class=cl>    /Users/majinyun/Codes/go/src/github.com/imajinyun/hello/hello_test.go:13: this is a log
</span></span><span class=line><span class=cl>--- PASS: TestLogfFunc <span class=o>(</span>0.00s<span class=o>)</span>
</span></span><span class=line><span class=cl>PASS
</span></span><span class=line><span class=cl>ok  	example.com/hello	0.015s
</span></span></code></pre></td></tr></table></div></div><h4 id=跳过方法>跳过方法</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>hello</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=s>&#34;errors&#34;</span>
</span></span><span class=line><span class=cl>  <span class=s>&#34;testing&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>TestSkipFunc</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>t</span><span class=p>.</span><span class=nf>Skip</span><span class=p>(</span><span class=s>&#34;this is a skip&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>t</span><span class=p>.</span><span class=nf>Log</span><span class=p>(</span><span class=s>&#34;see if this line will output #1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>TestSkipfFunc</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>t</span><span class=p>.</span><span class=nf>Logf</span><span class=p>(</span><span class=s>&#34;%s&#34;</span><span class=p>,</span> <span class=nx>errors</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=s>&#34;this is a skip&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=nx>t</span><span class=p>.</span><span class=nf>Log</span><span class=p>(</span><span class=s>&#34;see if this line will output #2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>TestSkipNowFunc</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>t</span><span class=p>.</span><span class=nf>SkipNow</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=nx>t</span><span class=p>.</span><span class=nf>Log</span><span class=p>(</span><span class=s>&#34;see if this line will output #3&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>TestSkippedFunc</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=nx>t</span><span class=p>.</span><span class=nf>Skipped</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>t</span><span class=p>.</span><span class=nf>Log</span><span class=p>(</span><span class=s>&#34;see if this line will output #4&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ go <span class=nb>test</span> -timeout 30s -run <span class=s1>&#39;^(TestSkipFunc|TestSkipfFunc|TestSkipNowFunc|TestSkippedFunc)$&#39;</span> example.com/hello -v
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>===</span> RUN   TestSkipFunc
</span></span><span class=line><span class=cl>    /Users/majinyun/Codes/go/src/github.com/imajinyun/hello/hello_test.go:9: this is a skip
</span></span><span class=line><span class=cl>--- SKIP: TestSkipFunc <span class=o>(</span>0.00s<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>===</span> RUN   TestSkipfFunc
</span></span><span class=line><span class=cl>    /Users/majinyun/Codes/go/src/github.com/imajinyun/hello/hello_test.go:14: this is a skip
</span></span><span class=line><span class=cl>    /Users/majinyun/Codes/go/src/github.com/imajinyun/hello/hello_test.go:15: see <span class=k>if</span> this line will output <span class=c1>#2</span>
</span></span><span class=line><span class=cl>--- PASS: TestSkipfFunc <span class=o>(</span>0.00s<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>===</span> RUN   TestSkipNowFunc
</span></span><span class=line><span class=cl>--- SKIP: TestSkipNowFunc <span class=o>(</span>0.00s<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>===</span> RUN   TestSkippedFunc
</span></span><span class=line><span class=cl>--- PASS: TestSkippedFunc <span class=o>(</span>0.00s<span class=o>)</span>
</span></span><span class=line><span class=cl>PASS
</span></span><span class=line><span class=cl>ok  	example.com/hello	0.011s
</span></span></code></pre></td></tr></table></div></div><h3 id=并行测试>并行测试</h3><p>默认情况下，指定包的测试是按照顺序执行的，但也可以通过在测试的函数内部使用 <code>t.Parallel()</code> 来标志某些测试也可以被安全的并发执行（和默认的一样，假设参数名为 <code>t</code>）。在并行执行的情况下，只有当那些被标记为并行的测试才会被并行执行，所以只有一个测试函数时是没意义的。它应该在测试函数体中第一个被调用（在任何需要跳过的条件之后），因为它会重置测试时间：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>TestParallel</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>t</span><span class=p>.</span><span class=nf>Parallel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=c1>// actual test...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>在并发情况下，同时运行的测试的数量默认取决于 <code>GOMAXPROCS</code>。它可以通过 <code>-parallel n</code> 被指定（<code>go test -parallel 4</code>）。</p><p>另外一个可以实现并行的方法，尽管不是函数级粒度，但却是包级粒度，就是类似这样执行 <code>go test p1 p2 p3</code>（也就是说，同时调用多个测试包）。在这种情况下，包会被先编译，并同时被执行。当然，这对于总的时间来说是有好处的，但它也可能会导致错误变得具有不可预测性，比如一些资源被多个包同时使用时（例如，一些测试需要访问数据库，并删除一些行，而这些行又刚好被其他的测试包使用的话）。</p><p>为了保持可控性，<code>-p</code> 标志可以用来指定编译和测试的并发数。当仓库中有多个测试包，并且每个包在不同的子目录中，一个可以执行所有包的命令是 <code>go test ./...</code>，这包含当前目录和所有子目录。没有带 <code>-p</code> 标志执行时，总的运行时间应该接近于运行时间最长的包的时间（加上编译时间）。运行 <code>go test -p 1 ./...</code>，使编译和测试工具只能在一个包中执行时，总的时间应该接近于所有独立的包测试的时间加上编译的时间的总和。具体可以执行 <code>go test -p 3 ./...</code> 来看一下对运行时间的影响。</p><p>还有，另外一个可以并行化的地方是在包的代码里面。多亏了 Go 非常棒的并行原语，实际上，除非 <code>GOMAXPROCS</code> 通过环境变量或者在代码中显式设置为 <code>GOMAXPROCS=1</code>，否则，包中一个 <code>goroutines</code> 都没有用是不太常见的。想要使用 <code>2</code> 个 <code>CPU</code>，可以执行 <code>GOMAXPROCS=2 go test</code>，想要使用 <code>4</code> 个 <code>CPU</code>，可以执行 <code>GOMAXPROCS=4 go test</code>，但还有更好的方法：<code>go test -cpu=1,2,4</code> 将会执行 <code>3</code> 次，其中 <code>GOMAXPROCS</code> 值分别为 <code>1,2,4</code>。</p><p>待测代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>hello</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;sync&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=nx>data</span>   <span class=p>=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>string</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=nx>locker</span> <span class=nx>sync</span><span class=p>.</span><span class=nx>RWMutex</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>SetToMap</span><span class=p>(</span><span class=nx>k</span><span class=p>,</span> <span class=nx>v</span> <span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>locker</span><span class=p>.</span><span class=nf>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=k>defer</span> <span class=nx>locker</span><span class=p>.</span><span class=nf>Unlock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=nx>data</span><span class=p>[</span><span class=nx>k</span><span class=p>]</span> <span class=p>=</span> <span class=nx>v</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>GetToMap</span><span class=p>(</span><span class=nx>k</span> <span class=kt>string</span><span class=p>)</span> <span class=kt>string</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>locker</span><span class=p>.</span><span class=nf>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=k>defer</span> <span class=nx>locker</span><span class=p>.</span><span class=nf>RUnlock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>data</span><span class=p>[</span><span class=nx>k</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>测试代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>hello</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;testing&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>mapTests</span> <span class=p>=</span> <span class=p>[]</span><span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>k</span><span class=p>,</span> <span class=nx>v</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}{</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span><span class=s>&#34;name&#34;</span><span class=p>,</span> <span class=s>&#34;🎉 Hello World&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span><span class=s>&#34;nickname&#34;</span><span class=p>,</span> <span class=s>&#34;Golang&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span><span class=s>&#34;email&#34;</span><span class=p>,</span> <span class=s>&#34;example@golang.com&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span><span class=s>&#34;phone&#34;</span><span class=p>,</span> <span class=s>&#34;12311118888&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span><span class=s>&#34;address&#34;</span><span class=p>,</span> <span class=s>&#34;Nanyang Technological University&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span><span class=s>&#34;compony&#34;</span><span class=p>,</span> <span class=s>&#34;Amazon&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>TestSetToMap</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>t</span><span class=p>.</span><span class=nf>Parallel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>tt</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>mapTests</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nf>SetToMap</span><span class=p>(</span><span class=nx>tt</span><span class=p>.</span><span class=nx>k</span><span class=p>,</span> <span class=nx>tt</span><span class=p>.</span><span class=nx>v</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>TestGetToMap</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>t</span><span class=p>.</span><span class=nf>Parallel</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>tt</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>mapTests</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>actual</span> <span class=o>:=</span> <span class=nf>GetToMap</span><span class=p>(</span><span class=nx>tt</span><span class=p>.</span><span class=nx>k</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>actual</span> <span class=o>!=</span> <span class=nx>tt</span><span class=p>.</span><span class=nx>v</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>t</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;GetToMap(%s) = %v, want: %v&#34;</span><span class=p>,</span> <span class=nx>tt</span><span class=p>.</span><span class=nx>k</span><span class=p>,</span> <span class=nx>actual</span><span class=p>,</span> <span class=nx>tt</span><span class=p>.</span><span class=nx>v</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ go <span class=nb>test</span> -v -timeout 30s -run ^<span class=o>(</span>TestSetToMap<span class=p>|</span>TestGetToMap<span class=o>)</span>$ example.com/hello
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>===</span> RUN   TestSetToMap
</span></span><span class=line><span class=cl>--- PASS: TestSetToMap <span class=o>(</span>0.00s<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>===</span> RUN   TestGetToMap
</span></span><span class=line><span class=cl>fatal error: sync: RUnlock of unlocked RWMutex
</span></span><span class=line><span class=cl>...
</span></span></code></pre></td></tr></table></div></div><p>因此，如果代码能够进行并行测试，在写测试时，尽量加上 <code>Parallel</code>，这样可以测试出一些可能的问题。</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2021-07-16</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://imajinyun.xyz/2021/07/16/go-unit-test/ data-title="Go 单元测试" data-hashtags=Go><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://imajinyun.xyz/2021/07/16/go-unit-test/ data-hashtag=Go><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Hacker News" data-sharer=hackernews data-url=https://imajinyun.xyz/2021/07/16/go-unit-test/ data-title="Go 单元测试"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://imajinyun.xyz/2021/07/16/go-unit-test/ data-title="Go 单元测试"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://imajinyun.xyz/2021/07/16/go-unit-test/ data-title="Go 单元测试"><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=https://imajinyun.xyz/tags/go/>Go</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=https://imajinyun.xyz/>主页</a></span></section></div><div class=post-nav><a href=https://imajinyun.xyz/2021/07/14/go-random-number/ class=prev rel=prev title="Go 随机数"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>Go 随机数</a>
<a href=https://imajinyun.xyz/2021/07/17/go-benchmark-test/ class=next rel=next title="Go 基准测试">Go 基准测试<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.102.3">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2018 - 2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://imajinyun.xyz/ target=_blank></a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/algoliasearch@4.13.1/dist/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:50},comment:{},search:{algoliaAppID:"MY71JUZ8GH",algoliaIndex:"ProdNotes",algoliaSearchKey:"06f460e5776acfe140c52e3ba3537780",highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:30,type:"algolia"}}</script><script type=text/javascript src=https://imajinyun.xyz/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-4TWZ0BV77P",{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-4TWZ0BV77P" async></script></body></html>